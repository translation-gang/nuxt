---
navigation.title: 'Кастомный useFetch'
title: Кастомный useFetch в Nuxt
description: Как сделать свой fetcher для вызова внешнего API в Nuxt.
---

При работе с внешним API часто нужны единые настройки запросов. Утилита [`$fetch`](/docs/4.x/api/utils/dollarfetch) (которую использует [`useFetch`](/docs/4.x/api/composables/use-fetch)) намеренно не настраивается глобально — так поведение запросов остаётся предсказуемым для приложения и модулей. Nuxt позволяет создать свой экземпляр fetcher (или несколько для разных API).

## Кастомный $fetch

Создайте экземпляр через [плагин Nuxt](/docs/4.x/directory-structure/app/plugins). `$fetch` — настроенный экземпляр [ofetch](https://github.com/unjs/ofetch) с поддержкой base URL сервера Nuxt и прямых вызовов при SSR (без HTTP-запросов).

Пример: API на https://api.nuxt.com, JWT в сессии ([nuxt-auth-utils](https://github.com/atinux/nuxt-auth-utils)), при 401 — редирект на `/login`:

```ts [app/plugins/api.ts]
export default defineNuxtPlugin((nuxtApp) => {
  const { session } = useUserSession()

  const api = $fetch.create({
    baseURL: 'https://api.nuxt.com',
    onRequest ({ request, options, error }) {
      if (session.value?.token) {
        options.headers.set('Authorization', `Bearer ${session.value?.token}`)
      }
    },
    async onResponseError ({ response }) {
      if (response.status === 401) {
        await nuxtApp.runWithContext(() => navigateTo('/login'))
      }
    },
  })

  return {
    provide: {
      api,
    },
  }
})
```

Через `useNuxtApp().$api` можно вызывать API из компонентов. Оборачивайте вызов в [`useAsyncData`](/docs/4.x/api/composables/use-async-data), чтобы избежать двойного запроса при SSR и гидрации.

## Кастомный useFetch / useAsyncData

Композабл `useAPI` с подставленным `$api`:

```ts [app/composables/useAPI.ts]
import type { UseFetchOptions } from 'nuxt/app'

export function useAPI<T> (
  url: string | (() => string),
  options?: UseFetchOptions<T>,
) {
  return useFetch(url, {
    ...options,
    $fetch: useNuxtApp().$api as typeof $fetch,
  })
}
```

Тип ошибки можно уточнить через дженерик `FetchError<CustomError>`. Та же схема подходит для кастомного `useAsyncData`.

:link-example{to="/docs/4.x/examples/advanced/use-custom-fetch-composable"}

:video-accordion{title="Видео про кастомный $fetch и Repository Pattern в Nuxt" videoId="jXH8Tr-exhI"}
