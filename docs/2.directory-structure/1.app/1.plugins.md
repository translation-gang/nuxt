---
title: "plugins (плагины)"
description: "В Nuxt есть система плагинов для подключения Vue-плагинов и другого кода при создании приложения."
head.title: "plugins/"
navigation.icon: i-vscode-icons-folder-type-plugin
---

Nuxt автоматически подхватывает файлы в `app/plugins/` и загружает их при создании Vue-приложения.

::note
Все плагины регистрируются автоматически, отдельно в `nuxt.config` их добавлять не нужно.
::

::note
Суффикс `.server` или `.client` в имени файла загружает плагин только на сервере или только на клиенте.
::

## Регистрация плагинов

Плагинами считаются только файлы на верхнем уровне директории и index-файлы во вложенных папках.

```bash [Структура каталогов]
-| plugins/
---| foo.ts      // сканируется
---| bar/
-----| baz.ts    // не сканируется
-----| foz.vue   // не сканируется
-----| index.ts  // сканируется (но считается устаревшим)
```

Регистрируются только `foo.ts` и `bar/index.ts`.

Плагины из подпапок можно добавить через опцию [`app/plugins`](/docs/4.x/api/nuxt-config#plugins-1) в `nuxt.config.ts`:

```ts twoslash [nuxt.config.ts]
export default defineNuxtConfig({
  plugins: [
    '~/plugins/bar/baz',
    '~/plugins/bar/foz',
  ],
})
```

## Создание плагинов

Единственный аргумент плагина — [`nuxtApp`](/docs/4.x/api/composables/use-nuxt-app).

```ts twoslash [plugins/hello.ts]
export default defineNuxtPlugin((nuxtApp) => {
  // Работа с nuxtApp
})
```

### Плагины в виде объекта

Для продвинутых сценариев плагин можно задать объектом:

```ts twoslash [plugins/hello.ts]
export default defineNuxtPlugin({
  name: 'my-plugin',
  enforce: 'pre', // или 'post'
  async setup (nuxtApp) {
    // эквивалент обычного функционального плагина
  },
  hooks: {
    'app:created' () {
      const nuxtApp = useNuxtApp()
      // ...
    },
  },
  env: {
    // false — не запускать при рендере server-only и island-компонентов
    islands: true,
  },
})
```

:video-accordion{title="Видео Alexander Lichter про объектный синтаксис плагинов Nuxt" videoId="2aXZyXB1QGQ"}

::note
При объектном синтаксисе свойства анализируются статически для оптимизации. Не задавайте их в рантайме (например, `enforce: import.meta.server ? 'pre' : 'post'`). Nuxt предзагружает слушатели хуков при объектном синтаксисе, порядок регистрации плагинов не важен.
::

## Порядок регистрации

Порядок задаётся алфавитной сортировкой имён файлов; для явного порядка используйте числовой префикс:

```bash [Структура каталогов]
plugins/
 | - 01.myPlugin.ts
 | - 02.myOtherPlugin.ts
```

В этом примере `02.myOtherPlugin.ts` сможет использовать то, что предоставил `01.myPlugin.ts`.

::note
Имена сортируются как строки: `10.myPlugin.ts` будет перед `2.myOtherPlugin.ts`. Поэтому для однозначных номеров используется префикс `0`.
::

## Стратегия загрузки

### Параллельные плагины

По умолчанию плагины загружаются последовательно. Плагин можно пометить как `parallel`, тогда следующий плагин начнёт выполняться сразу, не дожидаясь завершения текущего.

```ts twoslash [plugins/my-plugin.ts]
export default defineNuxtPlugin({
  name: 'my-plugin',
  parallel: true,
  async setup (nuxtApp) {
    // следующий плагин запустится сразу
  },
})
```

### Зависимости между плагинами

Если плагин должен ждать другой, укажите его имя в массиве `dependsOn`:

```ts twoslash [plugins/depending-on-my-plugin.ts]
export default defineNuxtPlugin({
  name: 'depends-on-my-plugin',
  dependsOn: ['my-plugin'],
  async setup (nuxtApp) {
    // этот плагин выполнится после завершения my-plugin
  },
})
```

## Использование композаблов

В плагинах Nuxt можно использовать [композаблы](/docs/4.x/directory-structure/app/composables) и [утилиты](/docs/4.x/directory-structure/app/utils):

```ts [app/plugins/hello.ts]
export default defineNuxtPlugin((nuxtApp) => {
  const foo = useFoo()
})
```

Ограничения:

::important
**Если композабл зависит от плагина, регистрируемого позже, он может не сработать.** Плагины вызываются по порядку и раньше остального кода.
::

::important
**Если композабл завязан на жизненный цикл Vue, в плагине он не сработает.** Композаблы привязаны к экземпляру компонента, а плагины — к экземпляру [`nuxtApp`](/docs/4.x/api/composables/use-nuxt-app).
::

## Предоставление хелперов

Чтобы добавить хелпер в экземпляр [`NuxtApp`](/docs/4.x/api/composables/use-nuxt-app), верните его из плагина в ключе `provide`:

::code-group
```ts twoslash [plugins/hello.ts]
export default defineNuxtPlugin(() => {
  return {
    provide: {
      hello: (msg: string) => `Hello ${msg}!`,
    },
  }
})
```
```ts twoslash [plugins/hello-object-syntax.ts]
export default defineNuxtPlugin({
  name: 'hello',
  setup () {
    return {
      provide: {
        hello: (msg: string) => `Hello ${msg}!`,
      },
    }
  },
})
```
::

Использование в компонентах:

```vue [app/components/Hello.vue]
<script setup lang="ts">
const { $hello } = useNuxtApp()
</script>

<template>
  <div>
    {{ $hello('world') }}
  </div>
</template>
```

::important
Предпочтительнее использовать [композаблы](/docs/4.x/directory-structure/app/composables), чтобы не засорять глобальное пространство имён и не раздувать основной бандл.
::

::warning
**Если плагин предоставляет `ref` или `computed`, в `<template>` они не разворачиваются.** Подробнее в [документации Vue](https://vuejs.org/guide/essentials/reactivity-fundamentals#caveat-when-unwrapping-in-templates).
::

## Типизация плагинов

Хелперы, возвращаемые из плагина, типизируются автоматически (в `useNuxtApp()` и в шаблонах).

::note
Чтобы использовать предоставленный хелпер _внутри_ другого плагина, вызовите [`useNuxtApp()`](/docs/4.x/api/composables/use-nuxt-app) — тип будет правильным. В общем случае лучше не полагаться на порядок плагинов.
::

Для сложных случаев типы инъекций можно объявить так:

```ts [index.d.ts]
declare module '#app' {
  interface NuxtApp {
    $hello (msg: string): string
  }
}

declare module 'vue' {
  interface ComponentCustomProperties {
    $hello (msg: string): string
  }
}

export {}
```

## Vue-плагины

Чтобы подключить Vue-плагин (например, [vue-gtag](https://github.com/MatteoGabriele/vue-gtag) для Google Analytics), создайте Nuxt-плагин:

Установка зависимости:

::code-group{sync="pm"}
```bash [npm]
npm install --save-dev vue-gtag-next
```
```bash [yarn]
yarn add --dev vue-gtag-next
```
```bash [pnpm]
pnpm add -D vue-gtag-next
```
```bash [bun]
bun add -D vue-gtag-next
```
```bash [deno]
deno add -D npm:vue-gtag-next
```
::

Плагин:

```ts [app/plugins/vue-gtag.client.ts]
import VueGtag, { trackRouter } from 'vue-gtag-next'

export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.use(VueGtag, {
    property: {
      id: 'GA_MEASUREMENT_ID',
    },
  })
  trackRouter(useRouter())
})
```

## Vue-директивы

Кастомную директиву можно зарегистрировать в плагине:

```ts twoslash [plugins/my-directive.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.directive('focus', {
    mounted (el) {
      el.focus()
    },
    getSSRProps (binding, vnode) {
      return {}
    },
  })
})
```

::warning
Директиву нужно регистрировать и на клиенте, и на сервере, если только вы не используете её только с одной стороны. Для клиентской директивы можно использовать `~/plugins/my-directive.client.ts` и «заглушку» в `~/plugins/my-directive.server.ts`.
::

:read-more{icon="i-simple-icons-vuedotjs" title="Кастомные директивы в документации Vue" to="https://vuejs.org/guide/reusability/custom-directives.html" target="_blank"}
