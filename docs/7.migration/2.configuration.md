---
title: "Конфигурация"
description: "Миграция конфигурации с Nuxt 2 на Nuxt 3."
---

## `nuxt.config`

Точка входа конфигурации по-прежнему — файл `nuxt.config`.

::note
Конфигурация Nuxt загружается через [`unjs/jiti`](https://github.com/unjs/jiti) и [`unjs/c12`](https://github.com/unjs/c12).
::

### Миграция

1. Перейдите на функцию `defineNuxtConfig` с типизированной схемой конфигурации.

   ::code-group

   ```ts [Nuxt 2]
   export default {
     // ...
   }
   ```

   ```ts [Nuxt 3]
   export default defineNuxtConfig({
     // ...
   })
   ```

   ::

2. Вместо `router.extendRoutes` используйте хук `pages:extend`:

   ::code-group

   ```ts [Nuxt 2]
   export default {
     router: {
       extendRoutes (routes) {
         //
       },
     },
   }
   ```

   ```ts [Nuxt 3]
   export default defineNuxtConfig({
     hooks: {
       'pages:extend' (routes) {
         //
       },
     },
   })
   ```

   ::

3. Логику `router.routeNameSplitter` перенесите в хук `pages:extend`, обновляя имена маршрутов:

   ::code-group

   ```ts [Nuxt 2]
   export default {
     router: {
       routeNameSplitter: '/',
     },
   }
   ```

   ```ts [Nuxt 3]
   import { createResolver } from '@nuxt/kit'

   export default defineNuxtConfig({
     hooks: {
       'pages:extend' (routes) {
         const routeNameSplitter = '/'
         const root = createResolver(import.meta.url).resolve('./pages')

         function updateName (routes) {
           if (!routes) {
             return
           }

           for (const route of routes) {
             const relativePath = route.file.substring(root.length + 1)
             route.name = relativePath.slice(0, -4).replace(/\/index$/, '').replace(/\//g, routeNameSplitter)

             updateName(route.children)
           }
         }
         updateName(routes)
       },
     },
   })
   ```

   ::

#### Синтаксис ESM

Nuxt 3 — [нативно ESM-фреймворк](/docs/4.x/guide/concepts/esm). В файле `nuxt.config` не используйте `require` и `module.exports`.

1. Замените `module.exports` на `export default`.
2. Замените `const lib = require('lib')` на `import lib from 'lib'`.

#### Асинхронная конфигурация

Асинхронный синтаксис конфига устарел. Для асинхронных операций используйте хуки Nuxt.

#### Dotenv

Nuxt сам подгружает файлы `.env`. Не импортируйте их напрямую из `nuxt.config`.

## Модули

Nuxt и модули Nuxt работают только на этапе сборки.

### Миграция

1. Перенесите все `buildModules` в `modules`.
2. Проверьте совместимость модулей с Nuxt 3.
3. Локальные модули указывайте на файл входа, а не на папку:

```diff
  export default defineNuxtConfig({
    modules: [
-     '~/modules/my-module'
+     '~/modules/my-module/index'
    ]
  })
```

::tip
Авторам модулей: [совместимость модулей](/docs/4.x/migration/module-authors) и [гайд по модулям](/docs/4.x/guide/modules).
::

## Изменения в структуре каталогов

Папка `static/` переименована в `public/`. Либо переименуйте каталог, либо задайте `dir.public` в `nuxt.config`.

:read-more{to="/docs/4.x/directory-structure/public"}

## TypeScript

Миграция проще при использовании TypeScript в Nuxt. Писать весь код на TypeScript не обязательно — Nuxt даст подсказки типов в редакторе.

Подробнее: [поддержка TypeScript в Nuxt](/docs/4.x/guide/concepts/typescript).

::note
Проверка типов: команда `nuxt typecheck` с [`vue-tsc`](https://github.com/vuejs/language-tools/tree/master/packages/tsc).
::

### Миграция

1. Создайте `tsconfig.json`:

   ```json
   {
     "files": [],
     "references": [
       {
         "path": "./.nuxt/tsconfig.app.json"
       },
       {
         "path": "./.nuxt/tsconfig.server.json"
       },
       {
         "path": "./.nuxt/tsconfig.shared.json"
       },
       {
         "path": "./.nuxt/tsconfig.node.json"
       }
     ]
   }
   ```

2. Выполните `npx nuxt prepare` для генерации tsconfig.
3. Установите Volar по [инструкции](/docs/4.x/getting-started/installation#prerequisites).

## Изменения во Vue

Рекомендации Vue и breaking changes между Vue 2 и 3. См. [гайд по миграции на Vue 3](https://v3-migration.vuejs.org) и [список breaking changes](https://v3-migration.vuejs.org/breaking-changes/).

[Vue 3 migration build](https://v3-migration.vuejs.org/migration-build.html) с Nuxt 3 использовать нельзя.

## Vuex

В Nuxt больше нет встроенной интеграции Vuex. Рекомендуется [pinia](https://pinia.vuejs.org) с [модулем для Nuxt](https://pinia.vuejs.org/ssr/nuxt.html).

Минимальная настройка глобального состояния на pinia:

Установите модуль [`@pinia/nuxt`](/modules/pinia):

```bash [Terminal]
yarn add pinia @pinia/nuxt
```

Подключите модуль в конфиге:

```ts [nuxt.config.ts]
import { defineNuxtConfig } from 'nuxt/config'

export default defineNuxtConfig({
  modules: ['@pinia/nuxt'],
})
```

Создайте папку `store` в корне приложения:

```ts [store/index.ts]
import { defineStore } from 'pinia'

export const useMainStore = defineStore('main', {
  state: () => ({
    counter: 0,
  }),
  actions: {
    increment () {
      // `this` is the store instance
      this.counter++
    },
  },
})
```

Создайте [плагин](/docs/4.x/directory-structure/app/plugins) для доступа к store глобально:

```ts [app/plugins/pinia.ts]
import { useMainStore } from '~/store'

export default defineNuxtPlugin(({ $pinia }) => {
  return {
    provide: {
      store: useMainStore($pinia),
    },
  }
})
```

Если нужен Vuex, мигрируйте на Vuex 4 по [инструкции](https://vuex.vuejs.org/guide/migrating-to-4-0-from-3-x.html).

После миграции добавьте плагин в приложение Nuxt:

```ts [app/plugins/vuex.ts]
import store from '~/store'

export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.vueApp.use(store)
})
```

Для больших приложений миграция может быть объёмной. Альтернатива — community-модуль [nuxt3-vuex-module](https://github.com/vedmant/nuxt3-vuex#nuxt3-vuex-module), работающий из коробки.
