---
title: Builder
description: Nuxt Kit предоставляет набор утилит, которые помогут вам работать со сборщиком. Эти функции позволяют вам расширять конфигурации Vite и webpack.
links:
  - label: Исходники
    icon: i-simple-icons-github
    to: https://github.com/nuxt/nuxt/blob/main/packages/kit/src/build.ts
    size: xs
---

В Nuxt есть сборщики на основе [Vite](https://github.com/nuxt/nuxt/tree/main/packages/vite) и [webpack](https://github.com/nuxt/nuxt/tree/main/packages/webpack). Вы можете расширить конфигурацию, передаваемую каждому из них, используя функции `extendViteConfig` и `extendWebpackConfig`. Вы также можете добавлять дополнительные плагины с помощью `addVitePlugin`, `addWebpackPlugin` и `addBuildPlugin`.

## `extendViteConfig`

Расширяет конфигурацию Vite. Колбэк может вызываться несколько раз (для клиентской и серверной сборок).

::warning
Хук устарел. Рекомендуется использовать плагин Vite с хуком `config` или, для конфигурации по окружениям, хук `applyToEnvironment`.
::

### Использование

```ts twoslash
import { defineNuxtModule, extendViteConfig } from '@nuxt/kit'

export default defineNuxtModule({
  setup () {
    extendViteConfig((config) => {
      config.optimizeDeps ||= {}
      config.optimizeDeps.include ||= []
      config.optimizeDeps.include.push('cross-fetch')
    })
  },
})
```

В Nuxt 5+ для конфигурации по окружениям используйте `addVitePlugin()`:

```ts twoslash
import { addVitePlugin, defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  setup () {
    // Глобальная конфигурация (все окружения)
    addVitePlugin(() => ({
      name: 'my-global-plugin',
      config (config) {
        // выполняется до настройки окружений
        config.optimizeDeps ||= {}
        config.optimizeDeps.include ||= []
        config.optimizeDeps.include.push('cross-fetch')
      },
    }))

    // Конфигурация для конкретного окружения
    addVitePlugin(() => ({
      name: 'my-client-plugin',
      applyToEnvironment (environment) {
        return environment.name === 'client'
      },
      configEnvironment (name, config) {
        // только для клиентского окружения
        config.optimizeDeps ||= {}
        config.optimizeDeps.include ||= []
        config.optimizeDeps.include.push('client-only-package')
      },
    }))
  },
})
```

::warning
**Важно:** хук `config` выполняется до `applyToEnvironment` и меняет глобальную конфигурацию. Для изменений по окружениям используйте `configEnvironment`.
::

### Тип

```ts twoslash
// @errors: 2391
import type { UserConfig as ViteConfig } from 'vite'
import type { ExtendViteConfigOptions } from '@nuxt/kit'
// ---cut---
function extendViteConfig (callback: ((config: ViteConfig) => void), options?: ExtendViteConfigOptions): void
```

::read-more{to="https://vite.dev/config/" target="_blank" icon="i-simple-icons-vite"}
Подробнее о конфигурации Vite на официальном сайте.
::

### Параметры

**`callback`**: функция, вызываемая с объектом конфигурации Vite.

**`options`**:

| Свойство  | Тип      | Обязательный | Описание |
|-----------|-----------|--------------|----------|
| `dev`     | `boolean` | нет          | `true` — вызывать при сборке в режиме разработки. |
| `build`   | `boolean` | нет          | `true` — вызывать при production-сборке. |
| `server`  | `boolean` | нет          | `true` — при сборке серверного бандла. **Устарело в Nuxt 5+.** Используйте `addVitePlugin()` с `applyToEnvironment()`. |
| `client`  | `boolean` | нет          | `true` — при сборке клиентского бандла. **Устарело в Nuxt 5+.** Используйте `addVitePlugin()` с `applyToEnvironment()`. |
| `prepend` | `boolean` | нет          | `true` — добавить колбэк в начало списка (`unshift` вместо `push`). |

## `extendWebpackConfig`

Расширяет конфигурацию webpack. Коллбэк-функция может быть вызвана несколько раз, для применения ее как к клиентским, так и к серверным сборкам.

### Использование

```ts twoslash
import { defineNuxtModule, extendWebpackConfig } from '@nuxt/kit'

export default defineNuxtModule({
  setup () {
    extendWebpackConfig((config) => {
      config.module!.rules!.push({
        test: /\.txt$/,
        use: 'raw-loader',
      })
    })
  },
})
```

### Тип

```ts twoslash
// @errors: 2391
import type { Configuration as WebpackConfig } from 'webpack'
import type { ExtendWebpackConfigOptions } from '@nuxt/kit'
// ---cut---
function extendWebpackConfig (callback: ((config: WebpackConfig) => void), options?: ExtendWebpackConfigOptions): void
```

::read-more{to="https://webpack.js.org/configuration/" target="_blank" icon="i-simple-icons-webpack"}
Подробнее о конфигурации webpack на официальном сайте.
::

### Параметры

**`callback`**: функция, вызываемая с объектом конфигурации webpack.

**`options`**: опции, передаваемые в колбэк. Объект может содержать:

| Свойство | Тип      | Обязательный | Описание                                                                                    |
|----------|----------|--------------|---------------------------------------------------------------------------------------------|
| `dev`    | `boolean`| нет          | `true` — колбэк вызывается при сборке в режиме разработки.                                 |
| `build`  | `boolean`| нет          | `true` — колбэк вызывается при production-сборке.                                           |
| `server` | `boolean`| нет          | `true` — колбэк вызывается при сборке серверного бандла.                                    |
| `client` | `boolean`| нет          | `true` — колбэк вызывается при сборке клиентского бандла.                                  |
| `prepend`| `boolean`| нет          | `true` — колбэк добавляется в начало массива через `unshift()` вместо `push()`.              |

## `addVitePlugin`

Добавляет плагин Vite в конфигурацию.

::warning
В Nuxt 5+ у плагинов, зарегистрированных с `server: false` или `client: false`, не вызываются хуки `config` и `configResolved`. Используйте метод `applyToEnvironment()` для плагинов по окружениям.
::

### Использование

```ts twoslash
// @errors: 2307
// ---cut---
import { addVitePlugin, defineNuxtModule } from '@nuxt/kit'
import { svg4VuePlugin } from 'vite-plugin-svg4vue'

export default defineNuxtModule({
  meta: {
    name: 'nuxt-svg-icons',
    configKey: 'nuxtSvgIcons',
  },
  defaults: {
    svg4vue: {
      assetsDirName: 'assets/icons',
    },
  },
  setup (options) {
    addVitePlugin(svg4VuePlugin(options.svg4vue))

    // или — плагин только для одного окружения
    addVitePlugin(() => ({
      name: 'my-client-plugin',
      applyToEnvironment (environment) {
        return environment.name === 'client'
      },
      // ... rest of your client-only plugin
    }))
  },
})
```

### Тип

```ts twoslash
// @errors: 2391
import type { Plugin as VitePlugin } from 'vite'
import type { ExtendViteConfigOptions } from '@nuxt/kit'
// ---cut---
function addVitePlugin (pluginOrGetter: VitePlugin | VitePlugin[] | (() => VitePlugin | VitePlugin[]), options?: ExtendViteConfigOptions): void
```

::tip
Подробнее о плагинах Vite: [Vite website](https://vite.dev/guide/api-plugin). Подборка плагинов: [awesome-vite](https://github.com/vitejs/awesome-vite#plugins).
::

### Параметры

**`pluginOrGetter`**: экземпляр плагина Vite, массив экземпляров или функция, возвращающая их (можно async/Promise — для ленивой загрузки):

```ts twoslash
// @errors: 2307
import { addVitePlugin, defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  setup () {
    // Ленивая загрузка — импорт при сборке
    addVitePlugin(() => import('my-vite-plugin').then(r => r.default()))
  },
})
```

**`options`**: опции для колбэка. Объект может содержать:

| Свойство | Тип      | Обязательный | Описание                                                                                                                       |
|----------|----------|--------------|--------------------------------------------------------------------------------------------------------------------------------|
| `dev`    | `boolean`| нет          | `true` — колбэк вызывается при сборке в режиме разработки.                                                                     |
| `build`  | `boolean`| нет          | `true` — колбэк вызывается при production-сборке.                                                                             |
| `server` | `boolean`| нет          | `true` — колбэк для серверного бандла. **Устарело в Nuxt 5+.** Используйте `applyToEnvironment()`.                              |
| `client` | `boolean`| нет          | `true` — колбэк для клиентского бандла. **Устарело в Nuxt 5+.** Используйте `applyToEnvironment()**.                           |
| `prepend`| `boolean`| нет          | `true` — колбэк добавляется в начало массива через `unshift()` вместо `push()`.                                                |

## `addWebpackPlugin`

Добавляет плагин webpack в конфигурацию.

### Использование

```ts
import EslintWebpackPlugin from 'eslint-webpack-plugin'
import { addWebpackPlugin, defineNuxtModule } from '@nuxt/kit'

export default defineNuxtModule({
  meta: {
    name: 'nuxt-eslint',
    configKey: 'eslint',
  },
  defaults: nuxt => ({
    include: [`${nuxt.options.srcDir}/**/*.{js,jsx,ts,tsx,vue}`],
    lintOnStart: true,
  }),
  setup (options, nuxt) {
    const webpackOptions = {
      ...options,
      context: nuxt.options.srcDir,
      files: options.include,
      lintDirtyModulesOnly: !options.lintOnStart,
    }
    addWebpackPlugin(new EslintWebpackPlugin(webpackOptions), { server: false })
  },
})
```

### Тип

```ts twoslash
// @errors: 2391
import type { WebpackPluginInstance } from 'webpack'
import type { ExtendWebpackConfigOptions } from '@nuxt/kit'
// ---cut---
function addWebpackPlugin (pluginOrGetter: WebpackPluginInstance | WebpackPluginInstance[] | (() => WebpackPluginInstance | WebpackPluginInstance[]), options?: ExtendWebpackConfigOptions): void
```

::tip
Подробнее о плагинах webpack: [webpack website](https://webpack.js.org/concepts/plugins/). Подборка: [awesome-webpack](https://webpack.js.org/awesome-webpack/#webpack-plugins).
::

### Параметры

**`pluginOrGetter`**: экземпляр плагина webpack, массив экземпляров или функция, возвращающая их (можно async/Promise для ленивой загрузки).

| Свойство | Тип      | Обязательный | Описание                                                                                    |
|----------|----------|--------------|---------------------------------------------------------------------------------------------|
| `dev`    | `boolean`| нет          | `true` — колбэк вызывается при сборке в режиме разработки.                                 |
| `build`  | `boolean`| нет          | `true` — колбэк вызывается при production-сборке.                                           |
| `server` | `boolean`| нет          | `true` — колбэк вызывается при сборке серверного бандла.                                    |
| `client` | `boolean`| нет          | `true` — колбэк вызывается при сборке клиентского бандла.                                  |
| `prepend`| `boolean`| нет          | `true` — колбэк добавляется в начало массива через `unshift()` вместо `push()`.            |

## `addBuildPlugin`

Универсальная версия `addVitePlugin` и `addWebpackPlugin`: добавляет плагин в конфигурации Vite и webpack, если они используются.

### Тип

```ts twoslash
// @errors: 2391
import type { ExtendConfigOptions } from '@nuxt/kit'
import type { Plugin as VitePlugin } from 'vite'
import type { WebpackPluginInstance } from 'webpack'
import type { RspackPluginInstance } from '@rspack/core'

interface AddBuildPluginFactory {
  vite?: () => VitePlugin | VitePlugin[]
  webpack?: () => WebpackPluginInstance | WebpackPluginInstance[]
  rspack?: () => RspackPluginInstance | RspackPluginInstance[]
}
// ---cut---
function addBuildPlugin (pluginFactory: AddBuildPluginFactory, options?: ExtendConfigOptions): void
```

### Параметры

**`pluginFactory`**: фабрика — объект с методами `vite` и/или `webpack` (и при необходимости `rspack`). Каждый метод возвращает экземпляр плагина или массив экземпляров для соответствующего билдера.

| Свойство | Тип      | Обязательный | Описание                                                                                    |
|----------|----------|--------------|---------------------------------------------------------------------------------------------|
| `dev`    | `boolean`| нет          | `true` — колбэк вызывается при сборке в режиме разработки.                                 |
| `build`  | `boolean`| нет          | `true` — колбэк вызывается при production-сборке.                                           |
| `server` | `boolean`| нет          | `true` — колбэк вызывается при сборке серверного бандла.                                    |
| `client` | `boolean`| нет          | `true` — колбэк вызывается при сборке клиентского бандла.                                    |
| `prepend`| `boolean`| нет          | `true` — колбэк добавляется в начало массива через `unshift()` вместо `push()`.              |
