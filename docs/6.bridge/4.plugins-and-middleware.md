---
title: "Плагины и middleware"
description: "Миграция плагинов и middleware с Nuxt 2 на Nuxt Bridge."
---

## Новый формат плагинов

Можно перейти на API плагинов Nuxt 3 (формат отличается от Nuxt 2).

Плагин получает один аргумент — `nuxtApp`. Подробнее в [документации](/docs/4.x/directory-structure/app/plugins).

```ts [app/plugins/hello.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.provide('injected', () => 'my injected function')
  // now available on `nuxtApp.$injected`
})
```

::note
Чтобы использовать новые композаблы Nuxt ([`useNuxtApp`](/docs/4.x/api/composables/use-nuxt-app), `useRuntimeConfig` и т.д.) в плагинах, объявляйте их через хелпер `defineNuxtPlugin`.
::

::warning
Через `nuxtApp.vueApp` доступен совместимый интерфейс, но не регистрируйте так плагины, директивы, миксины и компоненты без проверки «уже установлено» — иначе возможна утечка памяти.
::

## Новый формат middleware

Можно перейти на API middleware Nuxt 3 (формат отличается от Nuxt 2).

Middleware получает два аргумента — `to` и `from`. Подробнее в [документации](/docs/4.x/directory-structure/app/middleware).

```ts twoslash
export default defineNuxtRouteMiddleware((to) => {
  if (to.path !== '/') {
    return navigateTo('/')
  }
})
```

::important
`defineNuxtRouteMiddleware` поддерживается только в каталоге `app/middleware`.
::

## definePageMeta

В Nuxt Bridge доступен [`definePageMeta`](/docs/4.x/api/utils/define-page-meta).

Включается опцией `macros.pageMeta` в конфиге:

```ts [nuxt.config.ts]
import { defineNuxtConfig } from '@nuxt/bridge'

export default defineNuxtConfig({
  bridge: {
    macros: {
      pageMeta: true,
    },
  },
})
```

::note
Поддерживаются только ключи `middleware` и `layout`.
::
